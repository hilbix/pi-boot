#!/bin/bash

OOPS() { printf OOPS:; printf ' %q' "$@"; printf '\n'; exit 23; }
o() { "$@" || OOPS exec $?: "$@"; }

o cd "`dirname -- "$0"`/rpi23-gen-image"

rm -rf "$1/image/build"

export BASEDIR="$1/image"
export KERNELSRC_DIR="$1/kernel"
export UBOOTSRC_DIR="$1/u-boot"
export FBTURBOSRC_DIR="$1/video"
export RPI_FIRMWARE_DIR="$1/firmware"
export WLAN_FIRMWARESRC_DIR="$1/wlan"
export APT_PROXY="http://127.0.0.1:3142/"
export RPI_MODEL=3
export RELEASE=jessie
export BUILD_KERNEL=true

o ./rpi23-gen-image.sh

